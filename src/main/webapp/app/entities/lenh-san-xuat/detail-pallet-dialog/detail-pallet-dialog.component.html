<div class="dialog-container">
  <!-- Header -->
  <div class="dialog-header">
    <div class="dialog-title">
      <mat-icon class="title-icon">layers</mat-icon>
      <h2>
        {{
          data.mode === "multiple" ? "Package pallet list" : "Chi tiết pallet"
        }}
      </h2>
    </div>
    <button mat-icon-button (click)="onClose()" class="close-button">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Content -->
  <div class="dialog-content">
    <!-- Export button -->
    <div class="action-bar">
      <button mat-raised-button (click)="onExport()" class="export-button">
        <mat-icon>download</mat-icon>
        Xuất file
      </button>
    </div>

    <!-- DESKTOP VIEW - Table -->
    <div class="desktop-view">
      <div class="table-container">
        <table mat-table [dataSource]="paginatedItems" class="pallet-table">
          <!-- STT Column -->
          <ng-container matColumnDef="stt">
            <th mat-header-cell *matHeaderCellDef>STT</th>
            <td mat-cell *matCellDef="let element">{{ element.stt }}</td>
          </ng-container>

          <!-- Mã pallet with QR Code Column -->
          <ng-container matColumnDef="maPallet">
            <th mat-header-cell *matHeaderCellDef>Mã pallet</th>
            <td mat-cell *matCellDef="let element">
              <div class="qr-code-container">
                <div class="qr-code-placeholder">
                  <qrcode
                    [qrdata]="element.maPallet"
                    [width]="80"
                    [errorCorrectionLevel]="'M'"
                  >
                  </qrcode>
                </div>
              </div>
            </td>
          </ng-container>

          <!-- Mã pallet Text Column -->
          <ng-container matColumnDef="maPalletCode">
            <th mat-header-cell *matHeaderCellDef>Mã pallet</th>
            <td mat-cell *matCellDef="let element" class="pallet-code">
              {{ element.maPallet }}
            </td>
          </ng-container>

          <!-- Tiến độ scan Column -->
          <ng-container matColumnDef="tienDoScan">
            <th mat-header-cell *matHeaderCellDef>Tiến độ scan</th>
            <td mat-cell *matCellDef="let element">
              <div class="progress-container">
                <mat-progress-bar
                  mode="determinate"
                  [value]="getProgressPercentage(element)"
                  [color]="
                    getProgressPercentage(element) === 100
                      ? 'primary'
                      : 'accent'
                  "
                >
                </mat-progress-bar>
                <span class="progress-text"
                  >{{ element.tienDoScan }}/{{ element.tongSoThung }}</span
                >
              </div>
            </td>
          </ng-container>

          <!-- Sức chứa Column -->
          <ng-container matColumnDef="sucChua">
            <th mat-header-cell *matHeaderCellDef>Sức chứa</th>
            <td mat-cell *matCellDef="let element">{{ element.sucChua }}</td>
          </ng-container>

          <!-- Tùy chọn Column -->
          <ng-container matColumnDef="tuyChon">
            <th mat-header-cell *matHeaderCellDef>Tùy chọn</th>
            <td mat-cell *matCellDef="let element">
              <button
                mat-icon-button
                (click)="onPrint(element)"
                class="print-button"
              >
                <mat-icon>print</mat-icon>
              </button>
              <button
                mat-icon-button
                (click)="openScanDialog(element)"
                matTooltip="Scan thùng"
                matTooltipPosition="above"
                class="print-button"
              >
                <mat-icon>qr_code_scanner</mat-icon>
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>
      </div>
    </div>

    <!-- MOBILE VIEW - Cards -->
    <div class="mobile-view">
      <div class="pallet-cards-container">
        <div class="pallet-card" *ngFor="let item of paginatedItems">
          <!-- Card Header with STT -->
          <div class="card-header">
            <span class="card-stt">{{ item.stt }}</span>
          </div>

          <!-- QR Code -->
          <div class="card-qr-section">
            <qrcode
              [qrdata]="item.maPallet"
              [width]="70"
              [errorCorrectionLevel]="'M'"
            ></qrcode>
          </div>

          <!-- Pallet Code -->
          <div class="card-info-row">
            <span class="info-label">Mã pallet</span>
            <span class="info-value pallet-code-text">{{ item.maPallet }}</span>
          </div>

          <!-- Progress -->
          <div class="card-info-row">
            <span class="info-label">Tiến độ scan</span>
            <div class="progress-wrapper">
              <mat-progress-bar
                mode="determinate"
                [value]="getProgressPercentage(item)"
                [color]="
                  getProgressPercentage(item) === 100 ? 'primary' : 'accent'
                "
              >
              </mat-progress-bar>
              <span class="progress-text"
                >{{ item.tienDoScan }}/{{ item.tongSoThung }}</span
              >
            </div>
          </div>

          <!-- Capacity -->
          <div class="card-info-row">
            <span class="info-label">Sức chứa</span>
            <span class="info-value capacity-text">{{ item.sucChua }}</span>
          </div>

          <!-- Actions -->
          <div class="card-actions">
            <button
              mat-raised-button
              color="primary"
              (click)="onPrint(item)"
              class="action-btn"
            >
              <mat-icon>print</mat-icon>
              In tem
            </button>
            <button
              mat-raised-button
              color="accent"
              (click)="openScanDialog(item)"
              class="action-btn"
            >
              <mat-icon>qr_code_scanner</mat-icon>
              Scan
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <div class="pagination-container">
      <mat-paginator
        [length]="totalItems"
        [pageSize]="pageSize"
        [pageIndex]="pageIndex"
        [pageSizeOptions]="[5, 10, 25, 50]"
        (page)="onPageChange($event)"
        showFirstLastButtons
      >
      </mat-paginator>
    </div>
  </div>
</div>
