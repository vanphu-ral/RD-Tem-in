<div class="dialog-container">
  <div class="dialog-header">
    <div class="dialog-title">
      <mat-icon class="title-icon">{{ icon }}</mat-icon>
      <h2>{{ title }}</h2>
    </div>
    <button mat-icon-button (click)="onCancel()" class="close-button">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <div class="dialog-content">
    <form [formGroup]="form">
      <div class="form-field">
        <label class="field-label">Sản phẩm</label>
        <mat-form-field appearance="outline" class="full-width">
          <input
            matInput
            formControlName="maSanPham"
            placeholder="Mã sản phẩm"
            *ngIf="isBoxType"
          />
          <input
            matInput
            formControlName="tenSanPham"
            placeholder="Tên sản phẩm"
            *ngIf="!isBoxType"
          />
          <mat-error *ngIf="form.get('tenSanPham')?.hasError('notMatch')">
            Tên sản phẩm không khớp với dữ liệu gốc
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Form fields for Box type -->
      <ng-container *ngIf="isBoxType">
        <div class="form-row">
          <div class="form-field half-width">
            <label
              class="field-label"
              [ngClass]="{
                'error-label':
                  form.get('soLuongTrongThung')?.invalid &&
                  form.get('soLuongTrongThung')?.touched,
              }"
            >
              Số lượng SP trong 1 pallet
            </label>
            <mat-form-field appearance="outline" class="full-width">
              <input
                matInput
                type="number"
                formControlName="soLuongTrongThung"
              />
              <mat-error
                *ngIf="form.get('soLuongTrongThung')?.hasError('required')"
              >
                <span style="color: red">Bắt buộc nhập số lượng</span>
              </mat-error>
              <mat-error
                *ngIf="form.get('soLuongTrongThung')?.hasError('pattern')"
              >
                <span style="color: red"
                  >Chỉ nhập số nguyên từ 1 đến 99999, không thập phân</span
                >
              </mat-error>
              <mat-error *ngIf="form.get('soLuongTrongThung')?.hasError('max')">
                <span style="color: red"
                  >Số quá lớn, vượt giới hạn cho phép</span
                >
              </mat-error>
              <mat-error *ngIf="form.get('soLuongTrongThung')?.hasError('min')">
                <span style="color: red">Phải lớn hơn 0</span>
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-field half-width">
            <label
              class="field-label"
              [ngClass]="{
                'error-label':
                  form.get('soLuongThung')?.invalid &&
                  form.get('soLuongThung')?.touched,
              }"
              >Số lượng thùng</label
            >
            <mat-form-field appearance="outline" class="full-width">
              <input matInput type="number" formControlName="soLuongThung" />
              <mat-error *ngIf="form.get('soLuongThung')?.hasError('required')">
                <span style="color: red">Bắt buộc nhập số lượng</span>
              </mat-error>
              <mat-error *ngIf="form.get('soLuongThung')?.hasError('pattern')">
                <span style="color: red"
                  >Chỉ nhập số nguyên từ 1 đến 99999</span
                >
              </mat-error>
              <mat-error *ngIf="form.get('soLuongThung')?.hasError('max')">
                <span style="color: red">Không vượt quá 5 chữ số</span>
              </mat-error>
              <mat-error *ngIf="form.get('soLuongThung')?.hasError('min')">
                <span style="color: red">Phải lớn hơn 0</span>
              </mat-error>
            </mat-form-field>
          </div>
        </div>
      </ng-container>
      <ng-container *ngIf="isBoxType && data.loaiSanPham === 'Bán thành phẩm'">
        <div class="form-row">
          <div class="form-field half-width">
            <label
              class="field-label"
              [ngClass]="{
                'error-label':
                  form.get('extraFieldBTP')?.invalid &&
                  form.get('extraFieldBTP')?.touched,
              }"
            >
              TP/NK
            </label>
            <mat-form-field appearance="outline" class="full-width">
              <input matInput formControlName="TPNK" placeholder="TP/NK..." />
            </mat-form-field>
          </div>
          <div class="form-field half-width">
            <label
              class="field-label"
              [ngClass]="{
                'error-label':
                  form.get('extraFieldBTP')?.invalid &&
                  form.get('extraFieldBTP')?.touched,
              }"
            >
              Rank
            </label>
            <mat-form-field appearance="outline" class="full-width">
              <input
                matInput
                formControlName="rank"
                placeholder="Nhập rank..."
              />
            </mat-form-field>
          </div>
        </div>
        <div class="form-row">
          <div class="form-field full-width">
            <label
              class="field-label"
              [ngClass]="{
                'error-label':
                  form.get('extraFieldBTP')?.invalid &&
                  form.get('extraFieldBTP')?.touched,
              }"
            >
              MFG
            </label>
            <mat-form-field appearance="outline" class="full-width">
              <input matInput formControlName="mfg" placeholder="Nhập MFG..." />
            </mat-form-field>
          </div>
        </div>
        <div class="form-row">
          <div class="form-field full-width">
            <label class="field-label">Note</label>
            <mat-form-field appearance="outline" class="full-width">
              <textarea
                matInput
                formControlName="note"
                placeholder="Nhập ghi chú..."
                rows="2"
              ></textarea>
            </mat-form-field>
          </div>
        </div>
        <div class="form-row">
          <div class="form-field full-width">
            <label class="field-label">Comments</label>
            <mat-form-field appearance="outline" class="full-width">
              <textarea
                matInput
                formControlName="comments"
                placeholder="Comments..."
                rows="2"
              ></textarea>
            </mat-form-field>
          </div>
        </div>
      </ng-container>

      <!-- Form fields for Pallet type -->
      <ng-container *ngIf="!isBoxType">
        <div class="form-row">
          <div class="form-field half-width">
            <label class="field-label">Khách hàng</label>
            <mat-form-field appearance="outline" class="full-width">
              <input
                matInput
                formControlName="khachHang"
                placeholder="Tên khách hàng..."
              />
            </mat-form-field>
          </div>

          <div class="form-field half-width">
            <label class="field-label">PO Number</label>
            <mat-form-field appearance="outline" class="full-width">
              <input
                matInput
                formControlName="poNumber"
                placeholder="Số PO..."
              />
            </mat-form-field>
          </div>
        </div>

        <div class="form-row">
          <div class="form-field half-width">
            <label class="field-label">Date Code</label>
            <mat-form-field appearance="outline" class="full-width">
              <input
                matInput
                formControlName="dateCode"
                placeholder="Date Code..."
              />
            </mat-form-field>
          </div>

          <div class="form-field half-width">
            <label class="field-label">QDSX</label>
            <mat-form-field appearance="outline" class="full-width">
              <input matInput formControlName="qdsx" placeholder="Số QĐSX..." />
            </mat-form-field>
          </div>
        </div>

        <div class="form-row">
          <div class="form-field half-width">
            <label class="field-label">Người kiểm tra</label>
            <mat-form-field appearance="outline" class="full-width">
              <input
                matInput
                formControlName="nguoiKiemTra"
                placeholder="Tên người kiểm tra..."
              />
            </mat-form-field>
          </div>

          <div class="form-field half-width">
            <label class="field-label">Kết quả kiểm tra</label>
            <mat-form-field appearance="outline" class="full-width">
              <mat-select
                formControlName="ketQuaKiemTra"
                placeholder="Kết quả..."
              >
                <mat-option value="Đạt">Đạt</mat-option>
                <mat-option value="Không đạt">Không đạt</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>
        <div class="form-row">
          <div class="form-field half-width">
            <label class="field-label">No/SKU</label>
            <mat-form-field appearance="outline" class="full-width">
              <input matInput formControlName="noSKU" placeholder="No/SKU..." />
            </mat-form-field>
          </div>
          <div class="form-field half-width">
            <label
              class="field-label"
              [ngClass]="{
                'error-label':
                  form.get('qtyPerBox')?.invalid &&
                  form.get('qtyPerBox')?.touched,
              }"
              >Quy cách đóng gói, SL SP trong 1 thùng</label
            >
            <mat-form-field appearance="outline" class="full-width">
              <input
                matInput
                type="number"
                formControlName="qtyPerBox"
                placeholder="Số lượng trong 1 thùng..."
              />
              <mat-error *ngIf="form.get('qtyPerBox')?.hasError('required')">
                <span style="color: red">Bắt buộc nhập số lượng</span>
              </mat-error>
              <mat-error *ngIf="form.get('qtyPerBox')?.hasError('pattern')">
                <span style="color: red"
                  >Chỉ nhập số nguyên từ 1 đến 99999</span
                >
              </mat-error>
              <mat-error *ngIf="form.get('qtyPerBox')?.hasError('max')">
                <span style="color: red">Không vượt quá 5 chữ số</span>
              </mat-error>
              <mat-error *ngIf="form.get('qtyPerBox')?.hasError('min')">
                <span style="color: red">Phải lớn hơn 0</span>
              </mat-error>
            </mat-form-field>
          </div>
        </div>
        <div class="form-row">
          <div class="form-field full-width">
            <label class="field-label">Ghi chú</label>
            <mat-form-field appearance="outline" class="full-width">
              <textarea
                matInput
                formControlName="note"
                placeholder="Nhập ghi chú..."
                rows="2"
              ></textarea>
            </mat-form-field>
          </div>
        </div>
        <div class="form-row">
          <div class="form-field half-width flex-input">
            <label class="field-label">Số lượng thùng scan</label>
            <mat-form-field appearance="outline" class="full-width">
              <input
                matInput
                type="number"
                formControlName="soLuongThungScan"
              />
              <mat-error
                *ngIf="form.get('soLuongThungScan')?.hasError('required')"
              >
                <span style="color: red">Bắt buộc nhập số lượng</span>
              </mat-error>
              <mat-error
                *ngIf="form.get('soLuongThungScan')?.hasError('pattern')"
              >
                <span style="color: red"
                  >Chỉ nhập số nguyên từ 1 đến 99999</span
                >
              </mat-error>
              <mat-error *ngIf="form.get('soLuongThungScan')?.hasError('max')">
                <span style="color: red">Không vượt quá 5 chữ số</span>
              </mat-error>
              <mat-error *ngIf="form.get('soLuongThungScan')?.hasError('min')">
                <span style="color: red">Phải lớn hơn 0</span>
              </mat-error>
            </mat-form-field>
          </div>
        </div>
      </ng-container>

      <!-- Summary section -->
      <div class="summary-section">
        <ng-container *ngIf="isBoxType">
          <div class="summary-content">
            <span class="summary-label">Tổng số lượng:</span>
            <span class="summary-value">{{ totalQuantity }}</span>
          </div>
        </ng-container>

        <ng-container *ngIf="!isBoxType">
          <div class="summary-row">
            <div class="summary-item">
              <label
                class="field-label"
                [ngClass]="{
                  'error-label':
                    form.get('soLuongThungThucTe')?.invalid &&
                    form.get('soLuongThungThucTe')?.touched,
                }"
                >Số lượng thùng thực tế</label
              >
              <mat-form-field appearance="outline" class="summary-input">
                <input
                  matInput
                  type="number"
                  formControlName="soLuongThungThucTe"
                />
                <mat-error
                  *ngIf="form.get('soLuongThungThucTe')?.hasError('required')"
                >
                  <span style="color: red">Bắt buộc nhập số lượng</span>
                </mat-error>
                <mat-error
                  *ngIf="form.get('soLuongThungThucTe')?.hasError('pattern')"
                >
                  <span style="color: red"
                    >Chỉ nhập số nguyên từ 1 đến 99999</span
                  >
                </mat-error>
                <mat-error
                  *ngIf="form.get('soLuongThungThucTe')?.hasError('max')"
                >
                  <span style="color: red">Không vượt quá 5 chữ số</span>
                </mat-error>
                <mat-error
                  *ngIf="form.get('soLuongThungThucTe')?.hasError('min')"
                >
                  <span style="color: red">Phải lớn hơn 0</span>
                </mat-error>
              </mat-form-field>
            </div>

            <div class="summary-item">
              <label
                class="field-label"
                [ngClass]="{
                  'error-label':
                    form.get('soLuongPallet')?.invalid &&
                    form.get('soLuongPallet')?.touched,
                }"
                >Tổng số pallet tạo</label
              >
              <mat-form-field appearance="outline" class="summary-input">
                <input matInput type="number" formControlName="soLuongPallet" />
                <mat-error
                  *ngIf="form.get('soLuongPallet')?.hasError('required')"
                >
                  <span style="color: red">Bắt buộc nhập số lượng</span>
                </mat-error>
                <mat-error
                  *ngIf="form.get('soLuongPallet')?.hasError('pattern')"
                >
                  <span style="color: red"
                    >Chỉ nhập số nguyên từ 1 đến 99999</span
                  >
                </mat-error>
                <mat-error *ngIf="form.get('soLuongPallet')?.hasError('max')">
                  <span style="color: red">Không vượt quá 5 chữ số</span>
                </mat-error>
                <mat-error *ngIf="form.get('soLuongPallet')?.hasError('min')">
                  <span style="color: red">Phải lớn hơn 0</span>
                </mat-error>
              </mat-form-field>
            </div>
          </div>
        </ng-container>
      </div>
    </form>
  </div>

  <div class="dialog-actions">
    <button mat-stroked-button (click)="onCancel()" class="cancel-button">
      <mat-icon>close</mat-icon>
      Hủy
    </button>
    <!-- <button mat-raised-button color="primary" (click)="onSubmit()" [disabled]="!form.valid" class="submit-button"> -->
    <button
      mat-raised-button
      color="primary"
      (click)="onSubmit()"
      class="submit-button"
    >
      <mat-icon>check</mat-icon>
      Hoàn thành
    </button>
  </div>
</div>
