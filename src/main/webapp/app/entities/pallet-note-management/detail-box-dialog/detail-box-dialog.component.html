<div class="dialog-container">
  <!-- Header -->
  <div class="dialog-header">
    <div class="dialog-title">
      <mat-icon class="title-icon">view_in_ar</mat-icon>
      <h2>Chi tiết thùng sản phẩm</h2>
    </div>
    <button mat-icon-button (click)="onClose()" class="close-button">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Content -->
  <div class="dialog-content">
    <!-- Info Cards -->
    <div class="info-cards-container">
      <div class="info-card" *ngFor="let card of infoCards">
        <div class="info-label">{{ card.label }}</div>
        <div class="info-value">{{ card.value }}</div>
      </div>
    </div>

    <!-- Summary Cards -->
    <div class="summary-cards-container">
      <div class="summary-card">
        <div class="summary-label">Số lượng thùng</div>
        <div class="summary-value">{{ soLuongThung }}</div>
      </div>

      <div class="summary-card">
        <div class="summary-label">Tổng số lượng:</div>
        <div class="summary-value">{{ tongSoLuong }}</div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons-container">
      <button
        mat-raised-button
        color="primary"
        (click)="exportQRCodesPdfCurrentPage()"
        class="export-pdf-button"
      >
        <mat-icon>picture_as_pdf</mat-icon>
        Xuất PDF QR
      </button>
      <button
        mat-raised-button
        color="primary"
        (click)="exportExcelFromDialog()"
        class="export-excel-button"
        style="margin-left: 8px"
      >
        <mat-icon>grid_on</mat-icon>
        Xuất Excel
      </button>
    </div>

    <!-- Table view (desktop) -->
    <div class="table-container" *ngIf="!isMobile">
      <table mat-table [dataSource]="paginatedItems" class="box-table">
        <!-- STT Column -->
        <ng-container matColumnDef="stt">
          <th mat-header-cell *matHeaderCellDef>STT</th>
          <td mat-cell *matCellDef="let element">{{ element.stt }}</td>
        </ng-container>

        <ng-container matColumnDef="maThung">
          <th mat-header-cell *matHeaderCellDef>QR thùng</th>
          <td mat-cell *matCellDef="let element">
            <div class="qr-wrapper">
              <qrcode
                class="qr-img"
                [qrdata]="
                  data.isBtp
                    ? element.qrCode || element.maThung
                    : element.maThung
                "
                [width]="80"
                elementType="canvas"
              ></qrcode>

              <!-- QR phóng to -->
              <div class="qr-zoom">
                <qrcode
                  [qrdata]="
                    data.isBtp
                      ? element.qrCode || element.maThung
                      : element.maThung
                  "
                  [width]="220"
                  elementType="canvas"
                ></qrcode>
              </div>
            </div>
          </td>
        </ng-container>

        <ng-container matColumnDef="maThungCode">
          <th mat-header-cell *matHeaderCellDef>Mã thùng</th>
          <td mat-cell *matCellDef="let element">{{ element.maThung }}</td>
        </ng-container>

        <ng-container matColumnDef="soLuong">
          <th mat-header-cell *matHeaderCellDef>Số lượng</th>
          <td mat-cell *matCellDef="let element">{{ element.soLuong }}</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>
    </div>

    <!-- Card view (mobile) -->
    <div class="cards-container" *ngIf="isMobile">
      <div class="box-card" *ngFor="let element of paginatedItems">
        <div class="card-header">
          <span class="card-stt">#{{ element.stt }}</span>
        </div>
        <div class="card-body">
          <div class="qr-code">
            <qrcode
              [qrdata]="element.maThung"
              [width]="100"
              [errorCorrectionLevel]="'M'"
              elementType="img"
            ></qrcode>
          </div>
          <div class="card-info">
            <div><strong>Mã thùng:</strong> {{ element.maThung }}</div>
            <div><strong>Số lượng:</strong> {{ element.soLuong }}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <div class="pagination-container">
      <mat-paginator
        [length]="totalItems"
        [pageSize]="pageSize"
        [pageIndex]="pageIndex"
        [pageSizeOptions]="[5, 10, 25, 50]"
        (page)="onPageChange($event)"
        showFirstLastButtons
      >
      </mat-paginator>
    </div>
  </div>
</div>
